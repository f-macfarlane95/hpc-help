<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Terminal Clients Connection Guide (Keys) &mdash; Crop Diversity HPC Help  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Crop Diversity HPC Help
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="system-overview.html">System Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="user-accounts.html">Requesting an Account</a></li>
<li class="toctree-l1"><a class="reference internal" href="ssh.html">Getting Connected</a></li>
<li class="toctree-l1"><a class="reference internal" href="guest-accounts.html">Guest Accounts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">High performance computing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="slurm-overview.html">Slurm - Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="slurm-policy.html">Slurm - Queue Policies &amp; Advice</a></li>
<li class="toctree-l1"><a class="reference internal" href="slurm-shortcuts.html">Slurm - Shortcuts and Aliases</a></li>
<li class="toctree-l1"><a class="reference internal" href="bioconda.html">Bioconda</a></li>
<li class="toctree-l1"><a class="reference internal" href="compiling.html">Compiling Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="file-compression.html">Working with Compressed Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="singularity.html">Apptainer (Singularity)</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpu.html">GPU Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="machine-learning.html">Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="apps.html">Tools &amp; Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="database-mirrors.html">Database Mirrors</a></li>
<li class="toctree-l1"><a class="reference internal" href="openmpi.html">OpenMPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="green-computing.html">Green Computing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data storage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="data-storage.html">Data Storage &amp; Management Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="backups.html">Backups</a></li>
<li class="toctree-l1"><a class="reference internal" href="file-transfers.html">File Transfers</a></li>
<li class="toctree-l1"><a class="reference internal" href="samba.html">Samba Access</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Miscellaneous</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contact-us.html">Contact Us</a></li>
<li class="toctree-l1"><a class="reference internal" href="monitoring.html">Monitoring &amp; Tracking</a></li>
<li class="toctree-l1"><a class="reference internal" href="linux-basics.html">Linux Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="tips.html">Tips &amp; Tricks</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">The legal stuff</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="organizations.html">Supported Organisations</a></li>
<li class="toctree-l1"><a class="reference internal" href="sla.html">Service Level Agreement</a></li>
<li class="toctree-l1"><a class="reference internal" href="acceptable-use.html">Acceptable Use Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="gdpr.html">GDPR Privacy Notice</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Crop Diversity HPC Help</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Terminal Clients Connection Guide (Keys)</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/cropgeeks/hpc-help/blob/master/ssh-terminal-keys.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="terminal-clients-connection-guide-keys">
<h1>Terminal Clients Connection Guide (Keys)<a class="headerlink" href="#terminal-clients-connection-guide-keys" title="Permalink to this headline"></a></h1>
<p>To connect from remote addresses, we require using a cryptographic authentication instead of a password. For this authentication method you need to generate an <strong>SSH key pair</strong>.</p>
<p>SSH key pairs consist of two individual parts: a <strong>private</strong> and a <strong>public</strong> key. The private key must always be kept secret, much like a password. The public part, however, may be transported (as the name says) publicly and will be installed on <code class="docutils literal notranslate"><span class="pre">gruffalo</span></code>. Your private key will then be used to verify your access.</p>
<p>The following steps will show you how to generate a key pair and how to install it. If you already have a key pair, you can skip straight to the <a class="reference external" href="#installing-your-public-key">installing</a> section.</p>
<section id="generating-a-key-pair">
<h2>Generating a key pair<a class="headerlink" href="#generating-a-key-pair" title="Permalink to this headline"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Use your own PC/laptop to generate your key pair - don’t run these instructions on <code class="docutils literal notranslate"><span class="pre">gruffalo</span></code>.</p>
</div>
<p>The tool <strong>ssh-keygen</strong> can be used to generate an SSH key pair. For further details about its usage, please refer to the <em>ssh-keygen(1)</em> manual page.</p>
<p>If no parameter is specified on execution, ssh-keygen will create an RSA key, but <a class="reference external" href="https://en.wikipedia.org/wiki/EdDSA">Ed25519</a> keys are a better choice for <code class="docutils literal notranslate"><span class="pre">gruffalo</span></code>, and can be generated using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ssh-keygen -t ed25519
</pre></div>
</div>
<p>This will walk you through setting a location to store the keypair (stick with the default) and setting a passphrase for the private key:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Generating</span> <span class="n">public</span><span class="o">/</span><span class="n">private</span> <span class="n">ed25519</span> <span class="n">key</span> <span class="n">pair</span><span class="o">.</span>
<span class="n">Enter</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">which</span> <span class="n">to</span> <span class="n">save</span> <span class="n">the</span> <span class="n">key</span> <span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">dvader</span><span class="o">/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_ed25519</span><span class="p">):</span>
<span class="n">Enter</span> <span class="n">passphrase</span> <span class="p">(</span><span class="n">empty</span> <span class="k">for</span> <span class="n">no</span> <span class="n">passphrase</span><span class="p">):</span>
<span class="n">Enter</span> <span class="n">same</span> <span class="n">passphrase</span> <span class="n">again</span><span class="p">:</span>
<span class="n">Your</span> <span class="n">identification</span> <span class="n">has</span> <span class="n">been</span> <span class="n">saved</span> <span class="ow">in</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">dvader</span><span class="o">/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_ed25519</span>
<span class="n">Your</span> <span class="n">public</span> <span class="n">key</span> <span class="n">has</span> <span class="n">been</span> <span class="n">saved</span> <span class="ow">in</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">dvader</span><span class="o">/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_ed25519</span><span class="o">.</span><span class="n">pub</span>
<span class="n">The</span> <span class="n">key</span> <span class="n">fingerprint</span> <span class="ow">is</span><span class="p">:</span>
<span class="n">SHA256</span><span class="p">:</span><span class="n">EQNnu</span><span class="o">/</span><span class="mi">70</span><span class="n">ehGip3Ki1ghuqFTsEB7JpzDubsgzKTx0uTs</span> <span class="n">dvader</span><span class="nd">@localhost</span>
<span class="n">The</span> <span class="n">key</span><span class="s1">&#39;s randomart image is:</span>
<span class="o">+--</span><span class="p">[</span><span class="n">ED25519</span> <span class="mi">256</span><span class="p">]</span><span class="o">--+</span>
<span class="o">|</span>      <span class="o">..=</span>        <span class="o">|</span>
<span class="o">|.</span> <span class="o">.</span>    <span class="n">o</span> <span class="o">+</span>       <span class="o">|</span>
<span class="o">|</span><span class="n">o</span><span class="o">=</span> <span class="o">.</span>    <span class="n">o</span>        <span class="o">|</span>
<span class="o">|+.*</span>      <span class="n">o</span><span class="o">.</span> <span class="o">.</span>    <span class="o">|</span>
<span class="o">|</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span>   <span class="n">S</span><span class="o">.</span> <span class="o">.</span> <span class="o">.</span>   <span class="o">|</span>
<span class="o">|..=</span><span class="n">o</span>   <span class="o">..</span> <span class="o">.</span> <span class="o">.</span>    <span class="o">|</span>
<span class="o">|==</span><span class="n">oo</span><span class="o">.</span><span class="n">o</span>  <span class="o">.</span><span class="n">o</span><span class="o">.</span>  <span class="o">.</span>   <span class="o">|</span>
<span class="o">|*</span><span class="n">OoEo</span> <span class="o">+</span> <span class="n">oo</span> <span class="o">..</span>    <span class="o">|</span>
<span class="o">|=</span><span class="n">o</span><span class="o">+</span><span class="n">o</span><span class="o">+.</span> <span class="o">+</span>  <span class="n">oo</span><span class="o">.</span>    <span class="o">|</span>
<span class="o">+----</span><span class="p">[</span><span class="n">SHA256</span><span class="p">]</span><span class="o">-----+</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>It is <strong>critical</strong> that you protect your private key with a passphrase, and ideally ensure the disk it’s kept on is encrypted and that no-one else is ever given access to it. Remember, it’s <em>your</em> private key. Only the public half will be installed on <code class="docutils literal notranslate"><span class="pre">gruffalo</span></code>.</p>
</div>
<p>The keypair will be written to <code class="docutils literal notranslate"><span class="pre">~/.ssh/</span></code> on your local machine and consists of two files: the private key file and the public key-file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">~/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_ed25519</span>
<span class="o">~/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_ed25519</span><span class="o">.</span><span class="n">pub</span>
</pre></div>
</div>
<section id="your-public-key">
<h3>Your public key<a class="headerlink" href="#your-public-key" title="Permalink to this headline"></a></h3>
<p>Your public key - <code class="docutils literal notranslate"><span class="pre">id_ed25519.pub</span></code> - must be installed on the cluster to allow you remote access. It contains text that will be similar to the below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span><span class="o">-</span><span class="n">ed25519</span> <span class="n">AAARF3NzaC1lZDI1NTE5VVAAICJeEIONzSuv1GSKcvNmSSDUIB2zHB9byh8sAh4vnDha</span> <span class="p">[</span><span class="n">comment</span><span class="p">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you provided a custom name for your key, you may find it wasn’t created within <code class="docutils literal notranslate"><span class="pre">~/.ssh</span></code>. You can either rename/move the file to match the above listings, or use the <code class="docutils literal notranslate"><span class="pre">ssh</span> <span class="pre">-i</span></code> option to let SSH know where to find your private key.</p>
</div>
</section>
</section>
<section id="installing-your-public-key">
<h2>Installing your public key<a class="headerlink" href="#installing-your-public-key" title="Permalink to this headline"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are working from home or away from a <a class="reference internal" href="organizations.html"><span class="doc">Supported Organisations</span></a> network, then you won’t be able to install your public key using these instructions. Instead, you can email it to us (see <a class="reference internal" href="contact-us.html"><span class="doc">Contact Us</span></a> and we’ll get it installed for you.</p>
</div>
<p>To install your public key, visit <a class="reference external" href="https://ipa.cropdiversity.ac.uk">https://ipa.cropdiversity.ac.uk</a></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Depending on your browser, you may initially see a popup box prompting for your username and password. Ignore it, hitting Cancel or Escape until you see the screen below.</p>
</div>
<p>Log in using your username and password.</p>
<img alt="_images/freeipa-login.png" src="_images/freeipa-login.png" />
<p>It should default to showing you the details of your account, so scroll down until you see the section marked <strong>SSH public keys</strong>:</p>
<img alt="_images/freeipa-keys1.png" src="_images/freeipa-keys1.png" />
<p>Next, click <code class="docutils literal notranslate"><span class="pre">Add</span></code> and then paste your <em>public</em> key into the box that appears:</p>
<img alt="_images/freeipa-keys2.png" src="_images/freeipa-keys2.png" />
<p>Close the popup by pressing <code class="docutils literal notranslate"><span class="pre">Set</span></code>, then scroll back to the top of the page and select <code class="docutils literal notranslate"><span class="pre">Save</span></code> to confirm your changes.</p>
</section>
<section id="connecting-to-gruffalo">
<h2>Connecting to gruffalo<a class="headerlink" href="#connecting-to-gruffalo" title="Permalink to this headline"></a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you exceed three failed <strong>remote</strong> authentication attempts (within a 10 minute window) the system will block your IP address from further attempts for the next 30 minutes.</p>
</div>
<p>You can now test your key by attempting to connect to <code class="docutils literal notranslate"><span class="pre">gruffalo</span></code>. You should be asked for your private key’s <em>passphrase</em> rather than your user account’s <em>password</em>, as well as a <em>6-digit code</em> from your 2FA app:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ssh &lt;username&gt;@gruffalo.cropdiversity.ac.uk
Enter passphrase for key &#39;/home/&lt;username&gt;/.ssh/id_ed25519&#39;: [Passphrase]
2FA Verification Code: [6-digit code]
</pre></div>
</div>
<p>If you manage to log in successfully, then you should be good to connect from anywhere. Excellent!</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If have problems, try connecting with <code class="docutils literal notranslate"><span class="pre">ssh</span> <span class="pre">-vvv</span></code> which will produce lots of debug output and may give some hints as to where things are going wrong.</p>
</div>
</section>
<section id="additional-notes">
<h2>Additional notes<a class="headerlink" href="#additional-notes" title="Permalink to this headline"></a></h2>
<p>Many locations, including other institutions or public locations (airports, cafes, etc) may restrict which ports outgoing internet traffic can use, often locking it down to just a small subset that is enough for email and basic web access.</p>
<p>SSH uses port 22 by default, but if you find your connection to <code class="docutils literal notranslate"><span class="pre">gruffalo</span></code> being blocked, it’ll also accept connections on port 443, which is normally used for encrypted web traffic and therefore usually available. You can tell SSH to connect this way by passing <code class="docutils literal notranslate"><span class="pre">-p</span> <span class="pre">443</span></code> as an extra parameter, or by editing your <code class="docutils literal notranslate"><span class="pre">~/.ssh/config</span></code> file to include the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Host</span> <span class="n">gruffalo</span>
  <span class="n">Hostname</span> <span class="n">gruffalo</span><span class="o">.</span><span class="n">cropdiversity</span><span class="o">.</span><span class="n">ac</span><span class="o">.</span><span class="n">uk</span>
  <span class="n">Port</span> <span class="mi">443</span>
  <span class="n">User</span> <span class="o">&lt;</span><span class="n">username</span><span class="o">&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Only the most evil of deep-packet inspection (DPI) firewalls are likely to block SSH over port 443, so if you’re going to connect remotely a lot it’s probably worth setting port 443 as your default.</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022 Information &amp; Computational Sciences, The James Hutton Institute.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>